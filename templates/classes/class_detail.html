{% extends 'base/base.html' %}

{% block title %}{{ classroom.name }}{% endblock %}

{% block content %}
<!-- Welcome Card -->
<div class="card bg-success bg-opacity-25 mb-4" style="border-radius: 18px; box-shadow: 0 2px 8px rgba(0,0,0,0.08);">
    <div class="card-body text-center">
        <h1 class="mb-2">Welcome to {{ classroom.name }}</h1>
        {% if classroom.owner == request.user %}
            <p class="lead">Here you can upload materials and announcements for your students.</p>
            <div class="d-flex align-items-center justify-content-center mb-3">
                <span class="badge bg-light text-success fs-5 px-3 py-2 me-3" style="letter-spacing:2px;"><strong>Invite Code:</strong> {{ classroom.invite_code }}</span>
            </div>
            <!-- Owner Navigation Buttons -->
            <div class="d-flex justify-content-center gap-3 mt-3">
                <a href="{% url 'class_assignments' classroom.id %}" class="btn btn-primary">
                    <i class="bi bi-journal-text"></i> Class Assignments
                </a>
                <a href="{% url 'create_assignment' %}?class_id={{ classroom.id }}" class="btn btn-success">
                    <i class="bi bi-plus-circle"></i> Create Assignment
                </a>
                <a href="{% url 'grades:manage_grades' classroom.id %}" class="btn btn-warning">
                    <i class="bi bi-clipboard-check"></i> Manage Grades
                </a>
                <a href="{% url 'grades:class_summary' classroom.id %}" class="btn btn-info">
                    <i class="bi bi-graph-up"></i> View Dashboard
                </a>
            </div>
        {% else %}
            <p class="lead">Here you can access materials and announcements related to this class.</p>
            <!-- Student Navigation Buttons -->
            <div class="d-flex justify-content-center gap-3 mt-3">
                <a href="{% url 'class_assignments' classroom.id %}" class="btn btn-primary">
                    <i class="bi bi-journal-text"></i> Class Assignments
                </a>
                <a href="{% url 'grades:student_grades' %}" class="btn btn-success">
                    <i class="bi bi-trophy"></i> My Grades
                </a>
            </div>
        {% endif %}
    </div>
</div>

{% if classroom.owner == request.user %}
        <!-- Announcements Heading and Form -->
        <h4 class="mt-4 mb-2 fw-bold">Announcements</h4>
        <div class="card mb-3" style="border-radius: 16px;">
            <div class="card-body d-flex align-items-center">
                <img src="https://ui-avatars.com/api/?name={{ request.user.first_name }}+{{ request.user.last_name }}&background=40916c&color=fff&size=48" class="rounded-circle me-3" style="width:48px;height:48px;" alt="Owner Avatar">
                <form method="post" action="{% url 'post_announcement' classroom.id %}" class="flex-grow-1 d-flex align-items-center">
                    {% csrf_token %}
                    <input type="text" name="announcement" class="form-control me-2" placeholder="Announce something to your class" style="border: 2px solid #b2dfdb; background: #f8f9fa; font-size:1.1rem; font-style:italic; color: #aaa;" onfocus="this.style.color='#212529';this.style.fontStyle='normal';" onblur="this.value==''?this.style.color='#aaa':null;">
                    <button type="submit" class="btn btn-primary px-4">Post</button>
                </form>
            </div>
        </div>
        <!-- Post Materials Heading and Form -->
        <h4 class="mt-4 mb-2 fw-bold">Post Materials</h4>
        <div class="card mb-4" style="border-radius: 16px;">
            <div class="card-body d-flex align-items-center">
                <form method="post" action="{% url 'upload_material' classroom.id %}" enctype="multipart/form-data" class="d-flex align-items-center w-100">
                    {% csrf_token %}
                    <input type="text" name="title" class="form-control me-2" placeholder="Material title" style="max-width:200px;">
                    <input type="file" name="material" class="form-control form-control-sm me-2" style="max-width:200px;">
                    <button type="submit" class="btn btn-success px-4">Upload Material</button>
                </form>
            </div>
        </div>
{% endif %}

<!-- Announcements List -->
<h4 class="mt-4 mb-2 fw-bold">All Announcements</h4>
<div class="mb-4">
    {% for post in classroom.posts.all %}
        <div class="card mb-2" style="border-radius: 12px;">
            <div class="card-body d-flex align-items-center">
                <div class="bg-primary rounded-circle d-flex align-items-center justify-content-center me-3" style="width:40px;height:40px;">
                    <i class="bi bi-megaphone text-white" style="font-size:1.5rem;"></i>
                </div>
                <div>
                    <strong>{{ post.author.get_full_name|default:post.author.username }}</strong> posted:<br>
                    <span class="d-block mb-1">{{ post.content }}</span>
                    <small class="text-muted">{{ post.created_at|date:"M d, H:i" }}</small>
                </div>
            </div>
        </div>
    {% empty %}
        <div class="card text-center text-muted py-4 mb-2" style="border-radius: 12px;">
            No announcements yet.
        </div>
    {% endfor %}
</div>
<!-- Materials List -->
<h4 class="mt-4 mb-2 fw-bold">All Materials</h4>
<div class="mb-4">
    {% for material in classroom.materials.all %}
        <div class="card mb-2" style="border-radius: 12px;">
            <div class="card-body d-flex align-items-center">
                <div class="bg-success rounded-circle d-flex align-items-center justify-content-center me-3" style="width:40px;height:40px;">
                    <i class="bi bi-file-earmark-arrow-up text-white" style="font-size:1.5rem;"></i>
                </div>
                <div>
                    <strong>{{ material.title }}</strong> uploaded by <span class="fw-semibold">{{ material.uploaded_by.get_full_name|default:material.uploaded_by.username }}</span><br>
                    <a href="{{ material.file.url }}" download class="btn btn-outline-primary btn-sm mt-1">Download</a>
                    <small class="text-muted ms-2">{{ material.uploaded_at|date:"M d, H:i" }}</small>
                </div>
            </div>
        </div>
    {% empty %}
        <div class="card text-center text-muted py-4 mb-2" style="border-radius: 12px;">
            No materials yet.
        </div>
    {% endfor %}
</div>
{% endblock %}